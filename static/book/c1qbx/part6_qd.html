
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>6. Quasidynamic earthquake cycles: antiplane &#8212; Integral equation tutorials</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/patch.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://tbenthompson.com/book/c1qbx/part6_qd.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Quasidynamic earthquake cycles on two faults" href="part7_qd_two_faults.html" />
    <link rel="prev" title="5. Viscoelasticity" href="part5_viscoelastic.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-114592151-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Integral equation tutorials</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Integral equation tutorials
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  The TDE sequence: triangular dislocation elements
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../tdes/sa_tdes.html">
   1. Using TDEs to build a fault model with topography.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tdes/sa_geometry.html">
   2. A fault and topography mesh of the South America subduction zone.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tdes/free_matvec.html">
   3. Minimizing memory usage: a matrix-free iterative solver
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tdes/low_rank.html">
   4. Low rank approximation of BEM matrices with adaptive cross approximation (ACA).
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tdes/hmatrix.html">
   5. GPU-accelerated hierarchical matrices for triangular dislocation elements.
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  The QBX sequence: quadrature by expansion
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="part1_nearfield.html">
   1. Computing boundary integrals with quadrature by expansion (QBX).
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="part2_screw_dislocation.html">
   2. QBX examples for the Laplace equation: fun with screw dislocations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="part3_surface_intersection.html">
   3. Slip on an infinite strike slip fault in an elastic half space
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="part4_topography.html">
   4. Topography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="part5_viscoelastic.html">
   5. Viscoelasticity
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   6. Quasidynamic earthquake cycles: antiplane
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="part7_qd_two_faults.html">
   7. Quasidynamic earthquake cycles on two faults
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="part8_thrust_qd.html">
   8. [DRAFT] Quasidynamic thrust fault earthquake cycles (plane strain)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  The volumetric sequence: beyond boundaries
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../volumetric/part1_solve_circle.html">
   1. [DRAFT] Solving a Dirichlet problem on a circle.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../volumetric/part2_mms_circle.html">
   2. [DRAFT] Method of manufactured solutions (MMS) for the Poisson equation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Back matter
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../references.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../thanks.html">
   Thanks!
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/c1qbx/part6_qd.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   6.1. Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-the-geometry">
   6.2. Setting up the geometry.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-for-fault-traction-given-fault-slip">
   6.3. Solving for fault traction given fault slip
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rate-and-state-friction">
   6.4. Rate and state friction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quasidynamic-earthquake-cycle-derivatives">
   6.5. Quasidynamic earthquake cycle derivatives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integrating-through-time">
   6.6. Integrating through time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-the-results">
   6.7. Plotting the results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparison-against-scec-seas-results">
   6.8. Comparison against SCEC SEAS results
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="quasidynamic-earthquake-cycles-antiplane">
<h1><span class="section-number">6. </span>Quasidynamic earthquake cycles: antiplane<a class="headerlink" href="#quasidynamic-earthquake-cycles-antiplane" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2><span class="section-number">6.1. </span>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Solving the SCEC SEAS problem BP1-QD for earthquake cycle simulation.</p></li>
<li><p>Computing traction given fault slip by rearranging the discretized integral equation.</p></li>
<li><p>Solving the quasidynamic rate-and-state friction equations with a protected Newton solver.</p></li>
<li><p>Time-stepping over several earthquake ruptures with an adaptive time-stepping routine.</p></li>
<li><p>Comparing against results from SCEC SEAS benchmark participants.</p></li>
</ul>
</div>
<div class="section" id="setting-up-the-geometry">
<h2><span class="section-number">6.2. </span>Setting up the geometry.<a class="headerlink" href="#setting-up-the-geometry" title="Permalink to this headline">¶</a></h2>
<p>Previously, we built the infrastructure for solving for displacement and stress everywhere in the domain given slip on a fault in an antiplane half space. This time, we’ll go a step further and simulate rate and state friction and slip on that fault. We’ll consider the quasidynamic approximation where we use a zero-th order approximation to the stress changes caused by fault slip. We’ll be solving <a class="reference external" href="https://strike.scec.org/cvws/seas/download/SEAS_BP1_QD.pdf">SCEC SEAS problem BP1-QD</a>. Click the link!</p>
<p>For a bit more background on the ideas here, you could take a look at <a class="reference external" href="https://tbenthompson.com/post/block_slider/">my previous explanation of modeling a quasidynamic spring-block-slider</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tectosaur2</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">gauss_rule</span><span class="p">,</span>
    <span class="n">refine_surfaces</span><span class="p">,</span>
    <span class="n">integrate_term</span><span class="p">,</span>
    <span class="n">panelize_symbolic_surface</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">tectosaur2.laplace2d</span> <span class="kn">import</span> <span class="n">double_layer</span><span class="p">,</span> <span class="n">hypersingular</span>
</pre></div>
</div>
</div>
</div>
<p>To start, we’ll build a heavily refined fault mesh and surface mesh. The surface mesh will be quite long to make sure that we’re capturing the half space assumption.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surf_half_L</span> <span class="o">=</span> <span class="mi">10000000</span>
<span class="n">fault_bottom</span> <span class="o">=</span> <span class="mi">40000</span>
<span class="n">max_panel_length</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">shear_modulus</span> <span class="o">=</span> <span class="mf">3.2e10</span>

<span class="n">quad_rule</span> <span class="o">=</span> <span class="n">gauss_rule</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>

<span class="n">panel_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fault</span> <span class="o">=</span> <span class="n">panelize_symbolic_surface</span><span class="p">(</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">t</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fault_bottom</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">quad_rule</span><span class="p">,</span>
    <span class="n">n_panels</span><span class="o">=</span><span class="mi">400</span>
<span class="p">)</span>

<span class="n">free</span> <span class="o">=</span> <span class="n">refine_surfaces</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">surf_half_L</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># free surface</span>
    <span class="p">],</span>
    <span class="p">(</span><span class="n">quad_rule</span><span class="p">),</span>
    <span class="n">control_points</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># nearfield surface panels and fault panels will be limited to 200m</span>
        <span class="c1"># at 200m per panel, we have ~40m per solution node because the panels</span>
        <span class="c1"># have 5 nodes each</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">fault_bottom</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
        <span class="c1"># farfield panels will be limited to 200000 m per panel at most</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">surf_half_L</span><span class="p">,</span> <span class="mi">200000</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The free surface mesh has </span><span class="si">{</span><span class="n">free</span><span class="o">.</span><span class="n">n_panels</span><span class="si">}</span><span class="s2"> panels with a total of </span><span class="si">{</span><span class="n">free</span><span class="o">.</span><span class="n">n_pts</span><span class="si">}</span><span class="s2"> points.&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The fault mesh has </span><span class="si">{</span><span class="n">fault</span><span class="o">.</span><span class="n">n_panels</span><span class="si">}</span><span class="s2"> panels with a total of </span><span class="si">{</span><span class="n">fault</span><span class="o">.</span><span class="n">n_pts</span><span class="si">}</span><span class="s2"> points.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The free surface mesh has 958 panels with a total of 4790 points.
The fault mesh has 400 panels with a total of 2000 points.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">free</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">free</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x ~ \mathrm{(km)}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y ~ \mathrm{(km)}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/part6_qd_5_0.png" src="../_images/part6_qd_5_0.png" />
</div>
</div>
<p>And, to start off the integration, we’ll construct the operators necessary for solving for free surface displacement from fault slip.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">singularities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="o">-</span><span class="n">surf_half_L</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">surf_half_L</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">fault_bottom</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">free_disp_to_free_disp</span><span class="p">,</span> <span class="n">fault_slip_to_free_disp</span><span class="p">),</span> <span class="n">report</span> <span class="o">=</span> <span class="n">integrate_term</span><span class="p">(</span>
    <span class="n">double_layer</span><span class="p">,</span> <span class="n">free</span><span class="o">.</span><span class="n">pts</span><span class="p">,</span> <span class="n">free</span><span class="p">,</span> <span class="n">fault</span><span class="p">,</span> <span class="n">singularities</span><span class="o">=</span><span class="n">singularities</span><span class="p">,</span> <span class="n">return_report</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">fault_slip_to_free_disp</span> <span class="o">=</span> <span class="n">fault_slip_to_free_disp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">free_disp_solve_mat</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">free_disp_to_free_disp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">free_disp_to_free_disp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="solving-for-fault-traction-given-fault-slip">
<h2><span class="section-number">6.3. </span>Solving for fault traction given fault slip<a class="headerlink" href="#solving-for-fault-traction-given-fault-slip" title="Permalink to this headline">¶</a></h2>
<p>The previous section should have been familiar, but now we need to go a step further. The goal is to construct a single matrix that computes the fault tractions given an input fault slip distribution. This matrix will be used during each time step of our fault simulation.</p>
<p>But because we’re using fullspace Green’s function, this matrix needs to include both the direct fault slip effect and the indirect effect that is mediated through the free surface. So, we’re actually going to be composing several matrices together to get our final <code class="docutils literal notranslate"><span class="pre">total_fault_slip_to_fault_stress</span></code> matrix:</p>
<ul class="simple">
<li><p>Combining <code class="docutils literal notranslate"><span class="pre">fault_slip_to_free_disp</span></code> and <code class="docutils literal notranslate"><span class="pre">free_disp_solve_mat</span></code>, we can compute the surface displacement given a fault slip distribution.</p></li>
<li><p>We will construct <code class="docutils literal notranslate"><span class="pre">free_disp_to_fault_stress</span></code> for computing the fault stress caused by a surface displacement field.</p></li>
<li><p>We also construct the direct fault slip effect matrix, <code class="docutils literal notranslate"><span class="pre">fault_slip_to_fault_stress</span></code>.</p></li>
</ul>
<p>Renaming these wordy matrix names to some simple letters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">fault_slip_to_fault_traction</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">free_disp_to_fault_traction</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">fault_slip_to_free_disp</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">free_disp_solve_mat</span>
</pre></div>
</div>
<p>we can write the full system:</p>
<div class="amsmath math notranslate nohighlight" id="equation-3133c21c-82c0-4ec1-ba7a-a9a1627ef912">
<span class="eqno">(6.1)<a class="headerlink" href="#equation-3133c21c-82c0-4ec1-ba7a-a9a1627ef912" title="Permalink to this equation">¶</a></span>\[\begin{bmatrix}
   A &amp; B \\
   C &amp; D
\end{bmatrix}\]</div>
<p>The second equation expands to the same linear system that we used before to solve for surface displacement: <span class="math notranslate nohighlight">\(u = -D^{-1}Cs\)</span>. Plugging that in, we get:</p>
<div class="amsmath math notranslate nohighlight" id="equation-13f2f0dc-facd-4e71-b3ee-20dba572baf1">
<span class="eqno">(6.2)<a class="headerlink" href="#equation-13f2f0dc-facd-4e71-b3ee-20dba572baf1" title="Permalink to this equation">¶</a></span>\[\begin{equation}
t = As - BD^{-1}Cs = (A - BD^{-1}C)s
\end{equation}\]</div>
<p>Thus, our goal matrix operator is <span class="math notranslate nohighlight">\(A - BD^{-1}C\)</span> and we will name this <code class="docutils literal notranslate"><span class="pre">total_fault_slip_to_fault_traction</span></code>. You might recognize this as the <a class="reference external" href="https://en.wikipedia.org/wiki/Schur_complement">Schur complement</a> of the matrix system above. We performed one of step of block matrix Gaussian elimination!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">free_disp_to_fault_stress</span><span class="p">,</span> <span class="n">fault_slip_to_fault_stress</span><span class="p">),</span> <span class="n">report</span> <span class="o">=</span> <span class="n">integrate_term</span><span class="p">(</span>
    <span class="n">hypersingular</span><span class="p">,</span>
    <span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">,</span>
    <span class="n">free</span><span class="p">,</span>
    <span class="n">fault</span><span class="p">,</span>
    <span class="n">tol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span>
    <span class="n">singularities</span><span class="o">=</span><span class="n">singularities</span><span class="p">,</span>
    <span class="n">return_report</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fault_slip_to_fault_stress</span> <span class="o">*=</span> <span class="n">shear_modulus</span>
<span class="n">free_disp_to_fault_stress</span> <span class="o">*=</span> <span class="n">shear_modulus</span>

<span class="n">fault_slip_to_fault_traction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">fault_slip_to_fault_stress</span><span class="p">[:,:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fault</span><span class="o">.</span><span class="n">normals</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">free_disp_to_fault_traction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">free_disp_to_fault_stress</span><span class="p">[:,:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fault</span><span class="o">.</span><span class="n">normals</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/tbent/Dropbox/active/eq/tectosaur2/tectosaur2/integrate.py:201: UserWarning: Some integrals failed to converge during adaptive integration. This an indication of a problem in either the integration or the problem formulation.
  warnings.warn(
/Users/tbent/Dropbox/active/eq/tectosaur2/tectosaur2/integrate.py:208: UserWarning: Some expanded integrals reached maximum expansion order. These integrals may be inaccurate.
  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="n">fault_slip_to_fault_traction</span>
<span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="n">free_disp_to_fault_traction</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">fault_slip_to_free_disp</span>
<span class="n">Dinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">free_disp_solve_mat</span><span class="p">)</span>

<span class="n">total_fault_slip_to_fault_traction</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Dinv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>I’ll just do a quick check to confirm that this operator is accurate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analytical_sd</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="o">-</span><span class="n">fault_bottom</span> <span class="o">/</span> <span class="n">free</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">numerical_sd</span> <span class="o">=</span> <span class="n">Dinv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="o">-</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rp</span> <span class="o">=</span> <span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">analytical_ft</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">shear_modulus</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">fault_bottom</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fault_bottom</span><span class="p">)))</span>
<span class="n">numerical_ft</span> <span class="o">=</span> <span class="n">total_fault_slip_to_fault_traction</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Stress error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">numerical_ft</span> <span class="o">-</span> <span class="n">analytical_ft</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">analytical_ft</span><span class="p">))),</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="n">fault_bottom</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\mathrm{depth ~~ (m)}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(|E_{\sigma}|)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Displacement error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">free</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numerical_sd</span> <span class="o">-</span> <span class="n">analytical_sd</span><span class="p">)),</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x ~~ \mathrm{(m)}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(|E_u|)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/mt/cmys2v_143q1kpcrdt5wcdyr0000gn/T/ipykernel_79373/3764098280.py:15: RuntimeWarning: divide by zero encountered in log10
  plt.plot(free.pts[:,0], np.log10(np.abs(numerical_sd - analytical_sd)), &#39;b-&#39;)
</pre></div>
</div>
<img alt="../_images/part6_qd_12_1.png" src="../_images/part6_qd_12_1.png" />
</div>
</div>
</div>
<div class="section" id="rate-and-state-friction">
<h2><span class="section-number">6.4. </span>Rate and state friction<a class="headerlink" href="#rate-and-state-friction" title="Permalink to this headline">¶</a></h2>
<p>Okay, now that we’ve constructed the necessary boundary integral operators, we get to move on to describing the frictional behavior on the fault.</p>
<p>This isn’t intended to be an introducion to earthquake physics or rate-and-state friction. Instead, we’re focusing on the numerical implementation. If you’d like to learn more about rate-and-state friction, I’d recommend… (SUGGEST A BOOK OR PAPER HERE)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">siay</span> <span class="o">=</span> <span class="mi">31556952</span> <span class="c1"># seconds in a year</span>
<span class="n">density</span> <span class="o">=</span> <span class="mi">2670</span>  <span class="c1"># rock density (kg/m^3)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">shear_modulus</span> <span class="o">/</span> <span class="n">density</span><span class="p">)</span>  <span class="c1"># Shear wave speed (m/s)</span>
<span class="n">eta</span> <span class="o">=</span> <span class="n">shear_modulus</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cs</span><span class="p">)</span>  <span class="c1"># The radiation damping coefficient (kg / (m^2 * s))</span>
<span class="n">Vp</span> <span class="o">=</span> <span class="mf">1e-9</span>  <span class="c1"># Rate of plate motion</span>
<span class="n">sigma_n</span> <span class="o">=</span> <span class="mf">50e6</span>  <span class="c1"># Normal stress (Pa)</span>

<span class="c1"># parameters describing &quot;a&quot;, the coefficient of the direct velocity strengthening effect</span>
<span class="n">a0</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">amax</span> <span class="o">=</span> <span class="mf">0.025</span>
<span class="n">fy</span> <span class="o">=</span> <span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">H</span> <span class="o">=</span> <span class="mi">15000</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">fp_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">fy</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">H</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fy</span> <span class="o">&gt;</span> <span class="o">-</span><span class="p">(</span><span class="n">H</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="n">a0</span> <span class="o">+</span> <span class="p">(</span><span class="n">amax</span> <span class="o">-</span> <span class="n">a0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fy</span> <span class="o">+</span> <span class="n">H</span><span class="p">)</span> <span class="o">/</span> <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="n">amax</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># state-based velocity weakening effect</span>
<span class="n">fp_b</span> <span class="o">=</span> <span class="mf">0.015</span>

<span class="c1"># state evolution length scale (m)</span>
<span class="n">fp_Dc</span> <span class="o">=</span> <span class="mf">0.008</span>

<span class="c1"># baseline coefficient of friction</span>
<span class="n">fp_f0</span> <span class="o">=</span> <span class="mf">0.6</span>

<span class="c1"># if V = V0 and at steady state, then f = f0, units are m/s</span>
<span class="n">fp_V0</span> <span class="o">=</span> <span class="mf">1e-6</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">fy</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">fy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fp_b</span><span class="p">),</span> <span class="n">fy</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/part6_qd_16_0.png" src="../_images/part6_qd_16_0.png" />
</div>
</div>
<p>First, a Python implementation of the quasidynamic shear stress equations. There are two components to a standard definition of rate and state friction:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ba511d45-3bc5-4910-b808-9d4327c70c33">
<span class="eqno">(6.3)<a class="headerlink" href="#equation-ba511d45-3bc5-4910-b808-9d4327c70c33" title="Permalink to this equation">¶</a></span>\[\begin{align}
\tau_{qd} = F(V, \theta)\\
\frac{d\theta}{dt} = G(V, \theta)
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(F(V, \theta)\)</span> is the strength of friction, depending on slip rate and state and <span class="math notranslate nohighlight">\(G(V, \theta)\)</span> gives the state evolution. For <span class="math notranslate nohighlight">\(G\)</span>, we will use the aging law, given by the <code class="docutils literal notranslate"><span class="pre">aging_law</span></code> function below.</p>
<p>We also need to relate the quasidynamic shear stress to the quasistatic shear stress:</p>
<div class="amsmath math notranslate nohighlight" id="equation-f7d16226-87f8-4f19-a723-1e700a30c56c">
<span class="eqno">(6.4)<a class="headerlink" href="#equation-f7d16226-87f8-4f19-a723-1e700a30c56c" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\tau_{qd} = \tau_{qs} - \eta * V
\end{equation}\]</div>
<p>which results in the full quasidynamic stress balance equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-5c661539-6956-43fd-8ec0-213f9bce52eb">
<span class="eqno">(6.5)<a class="headerlink" href="#equation-5c661539-6956-43fd-8ec0-213f9bce52eb" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\tau_{qs} - \eta * V - F(V, \theta) = 0
\end{equation}\]</div>
<p>The specific form we use here is  implemented below in the <code class="docutils literal notranslate"><span class="pre">qd_equation</span></code> function.</p>
<p>At each time step, we’ll need to compute the velocity, <span class="math notranslate nohighlight">\(V\)</span> and the state derivative <span class="math notranslate nohighlight">\(d\theta/dt\)</span>. Computing the state derivative is easy because it’s directly given by the aging law. But, computing the velocity is harder because its only given implicitly in the frictional strength equation. The <code class="docutils literal notranslate"><span class="pre">solve_friction</span></code> function below implements Newton’s method with a backtracking line search to solve the friction equation for the current velocity. The <code class="docutils literal notranslate"><span class="pre">qd_equation_dV</span></code> function implements the derivative of the stress balance with respect to velocity. This derivative is necessary for Newton’s method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The regularized form of the aging law. </span>
<span class="k">def</span> <span class="nf">aging_law</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">fp_b</span> <span class="o">*</span> <span class="n">fp_V0</span> <span class="o">/</span> <span class="n">fp_Dc</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">fp_f0</span> <span class="o">-</span> <span class="n">state</span><span class="p">)</span> <span class="o">/</span> <span class="n">fp_b</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">V</span> <span class="o">/</span> <span class="n">fp_V0</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">qd_equation</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">shear_stress</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="c1"># The regularized rate and state friction equation</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">sigma_n</span> <span class="o">*</span> <span class="n">fp_a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">V</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fp_V0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">state</span> <span class="o">/</span> <span class="n">fp_a</span><span class="p">))</span>
    
    <span class="c1"># The full shear stress balance:</span>
    <span class="k">return</span> <span class="n">shear_stress</span> <span class="o">-</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">V</span> <span class="o">-</span> <span class="n">F</span>

<span class="k">def</span> <span class="nf">qd_equation_dV</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="c1"># First calculate the derivative of the friction law with respect to velocity</span>
    <span class="c1"># This is helpful for equation solving using Newton&#39;s method</span>
    <span class="n">expsa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">state</span> <span class="o">/</span> <span class="n">fp_a</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span> <span class="o">*</span> <span class="n">expsa</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fp_V0</span><span class="p">)</span>
    <span class="n">dFdV</span> <span class="o">=</span> <span class="n">fp_a</span> <span class="o">*</span> <span class="n">expsa</span> <span class="o">*</span> <span class="n">sigma_n</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fp_V0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">Q</span><span class="p">))</span>

    <span class="c1"># The derivative of the full shear stress balance.</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">eta</span> <span class="o">-</span> <span class="n">dFdV</span>


<span class="k">def</span> <span class="nf">solve_friction</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">shear</span><span class="p">,</span> <span class="n">V_old</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">):</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">V_old</span>
    <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">150</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
        <span class="c1"># Newton&#39;s method step!</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">qd_equation</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">shear</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="n">dfdv</span> <span class="o">=</span> <span class="n">qd_equation_dV</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">dfdv</span>

        <span class="c1"># We know that slip velocity should not be negative so any step that</span>
        <span class="c1"># would lead to negative slip velocities is &quot;bad&quot;. In those cases, we</span>
        <span class="c1"># cut the step size in half iteratively until the step is no longer</span>
        <span class="c1"># bad. This is a backtracking line search.</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">bad</span> <span class="o">=</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">V</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">bad</span><span class="p">):</span>
                <span class="n">step</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Take the step and check if everything has converged.</span>
        <span class="n">Vn</span> <span class="o">=</span> <span class="n">V</span> <span class="o">-</span> <span class="n">step</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">/</span> <span class="n">Vn</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Vn</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">max_iter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to converge.&quot;</span><span class="p">)</span>

    <span class="c1"># Return the solution and the number of iterations required.</span>
    <span class="k">return</span> <span class="n">Vn</span><span class="p">,</span> <span class="n">i</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll also check <span class="math notranslate nohighlight">\(h^*\)</span> which is the minimum length scale of an instability and <span class="math notranslate nohighlight">\(L_b\)</span>, the length scale of the rupture process zone. Both these length scales need to be well resolved by the fault discretization. Here we have approximately eight point within the process zone and almost 80 points within <span class="math notranslate nohighlight">\(h^*\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mesh_L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])))</span>
<span class="n">Lb</span> <span class="o">=</span> <span class="n">shear_modulus</span> <span class="o">*</span> <span class="n">fp_Dc</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_n</span> <span class="o">*</span> <span class="n">fp_b</span><span class="p">)</span>
<span class="n">hstar</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">shear_modulus</span> <span class="o">*</span> <span class="n">fp_Dc</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_n</span> <span class="o">*</span> <span class="p">(</span><span class="n">fp_b</span> <span class="o">-</span> <span class="n">fp_a</span><span class="p">))</span>
<span class="n">mesh_L</span><span class="p">,</span> <span class="n">Lb</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">hstar</span><span class="p">[</span><span class="n">hstar</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(26.92346550528964, 341.3333333333333, 3216.990877275949)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="quasidynamic-earthquake-cycle-derivatives">
<h2><span class="section-number">6.5. </span>Quasidynamic earthquake cycle derivatives<a class="headerlink" href="#quasidynamic-earthquake-cycle-derivatives" title="Permalink to this headline">¶</a></h2>
<p>Let’s set of the last few pieces to do a full earthquake cycle simulation:</p>
<ul class="simple">
<li><p>initial conditions.</p></li>
<li><p>a function to put the pieces together and calculate the full system state at each time step, including the time derivatives of slip and frictional state.</p></li>
<li><p>the time stepping algorithm itself.</p></li>
</ul>
<p>First, <strong>initial conditions</strong>. This initial state is exactly as specified in the BP-1 description linked at the top:</p>
<ol class="simple">
<li><p>We solve for the steady frictional state at each point using <code class="docutils literal notranslate"><span class="pre">scipy.optimize.fsolve</span></code>. This is the initial state.</p></li>
<li><p>We identify the value of shear stress that will result in steady plate rate slip rates in the deeper portions of the fault: <code class="docutils literal notranslate"><span class="pre">tau_amax</span></code>. This is the initial shear stress.</p></li>
<li><p>The initial slip deficit is zero.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="n">init_state_scalar</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="k">lambda</span> <span class="n">S</span><span class="p">:</span> <span class="n">aging_law</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">Vp</span><span class="p">,</span> <span class="n">S</span><span class="p">),</span> <span class="mf">0.7</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">init_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">n_pts</span><span class="p">,</span> <span class="n">init_state_scalar</span><span class="p">)</span>
<span class="n">tau_amax</span> <span class="o">=</span> <span class="o">-</span><span class="n">qd_equation</span><span class="p">(</span><span class="n">amax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Vp</span><span class="p">,</span> <span class="n">init_state_scalar</span><span class="p">)</span>

<span class="n">init_traction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">n_pts</span><span class="p">,</span> <span class="n">tau_amax</span><span class="p">)</span>
<span class="n">init_slip_deficit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">n_pts</span><span class="p">)</span>
<span class="n">init_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">init_slip_deficit</span><span class="p">,</span> <span class="n">init_state</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Next, solving for system state. This ties the pieces together by:</p>
<ol class="simple">
<li><p>Solving for the quasistatic shear stress using the boundary integral matrices derived at the beginning of this notebook.</p></li>
<li><p>Solving the rate and state friction equations for the slip rate.</p></li>
<li><p>Calculating the state evolution using the aging law.</p></li>
</ol>
<p>The middle lines of <code class="docutils literal notranslate"><span class="pre">SystemState.calc</span></code> do these three steps. There’s a bunch of other code surrounding those three lines in order to deal with invalid inputs and transform from slip to slip deficit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SystemState</span><span class="p">:</span>

    <span class="n">V_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">n_pts</span><span class="p">,</span> <span class="n">Vp</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Separate the slip_deficit and state sub components of the </span>
        <span class="c1"># time integration state.</span>
        <span class="n">slip_deficit</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span> <span class="n">init_slip_deficit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">init_slip_deficit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:]</span>

        <span class="c1"># If the state values are bad, then the adaptive integrator probably</span>
        <span class="c1"># took a bad step.</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">state</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">state</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># The big three lines solving for quasistatic shear stress, slip rate</span>
        <span class="c1"># and state evolution</span>
        <span class="n">tau_qs</span> <span class="o">=</span> <span class="n">init_traction</span> <span class="o">-</span> <span class="n">total_fault_slip_to_fault_traction</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">slip_deficit</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">solve_friction</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">tau_qs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_old</span><span class="p">,</span> <span class="n">state</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dstatedt</span> <span class="o">=</span> <span class="n">aging_law</span><span class="p">(</span><span class="n">fp_a</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">V</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_old</span> <span class="o">=</span> <span class="n">V</span>

        <span class="n">slip_deficit_rate</span> <span class="o">=</span> <span class="n">Vp</span> <span class="o">-</span> <span class="n">V</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">slip_deficit</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">tau_qs</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">slip_deficit_rate</span><span class="p">,</span> <span class="n">dstatedt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">out</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>


<span class="k">def</span> <span class="nf">plot_system_state</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">SS</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is just a helper function that creates some rough plots of the</span>
<span class="sd">    current state to help with debugging&quot;&quot;&quot;</span>
    <span class="n">slip_deficit</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">tau_qs</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">slip_deficit_rate</span><span class="p">,</span> <span class="n">dstatedt</span> <span class="o">=</span> <span class="n">SS</span>
    
    <span class="n">slip</span> <span class="o">=</span> <span class="n">Vp</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">slip_deficit</span>
    
    <span class="n">fd</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">fault</span><span class="o">.</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;t=</span><span class="si">{</span><span class="n">t</span><span class="o">/</span><span class="n">siay</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;slip&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">slip</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;slip deficit&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">slip_deficit</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="c1"># plt.subplot(3, 3, 2)</span>
    <span class="c1"># plt.title(&quot;slip deficit rate&quot;)</span>
    <span class="c1"># plt.plot(fd, slip_deficit_rate)</span>
    <span class="c1"># plt.xlim(xlim)</span>

    <span class="c1"># plt.subplot(3, 3, 2)</span>
    <span class="c1"># plt.title(&quot;strength&quot;)</span>
    <span class="c1"># plt.plot(fd, tau_qs/sigma_qs)</span>
    <span class="c1"># plt.xlim(xlim)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tau_</span><span class="si">{qs}</span><span class="s2">$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">tau_qs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;dstatedt&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">dstatedt</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">calc_derivatives</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This helper function calculates the system state and then extracts the</span>
<span class="sd">    relevant derivatives that the integrator needs. It also intentionally</span>
<span class="sd">    returns infinite derivatives when the `y` vector provided by the integrator</span>
<span class="sd">    is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">y</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">y</span>
    <span class="n">derivatives</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">state</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">derivatives</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="integrating-through-time">
<h2><span class="section-number">6.6. </span>Integrating through time<a class="headerlink" href="#integrating-through-time" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">RK45</span>

<span class="c1"># We use a 5th order adaptive Runge Kutta method and pass the derivative function to it</span>
<span class="c1"># the relative tolerance will be 1e-11 to make sure that even </span>
<span class="n">state</span> <span class="o">=</span> <span class="n">SystemState</span><span class="p">()</span>
<span class="n">derivs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">calc_derivatives</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">RK45</span>
<span class="n">atol</span> <span class="o">=</span> <span class="n">Vp</span> <span class="o">*</span> <span class="mf">1e-6</span>
<span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-11</span>
<span class="n">rk</span> <span class="o">=</span> <span class="n">integrator</span><span class="p">(</span><span class="n">derivs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">init_conditions</span><span class="p">,</span> <span class="mf">1e50</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">)</span>

<span class="c1"># Set the initial time step to one day.</span>
<span class="n">rk</span><span class="o">.</span><span class="n">h_abs</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span>

<span class="c1"># Integrate for 1000 years.</span>
<span class="n">max_T</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">siay</span>

<span class="n">n_steps</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">t_history</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y_history</span> <span class="o">=</span> <span class="p">[</span><span class="n">init_conditions</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
    
    <span class="c1"># Take a time step and store the result</span>
    <span class="k">if</span> <span class="n">rk</span><span class="o">.</span><span class="n">step</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;TIME STEPPING FAILED&quot;</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="n">t_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rk</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
    <span class="n">y_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rk</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

    <span class="c1"># Print the time every 5000 steps</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;step=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">rk</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="n">siay</span><span class="si">}</span><span class="s2"> yrs, step=</span><span class="si">{</span><span class="p">(</span><span class="n">rk</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">t_history</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">siay</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rk</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="n">max_T</span><span class="p">:</span>
        <span class="k">break</span>

<span class="n">y_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_history</span><span class="p">)</span>
<span class="n">t_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t_history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>step=0, time=0.0021812680462764775 yrs, step=0.0021812680462764775
step=5000, time=140.7230427507717 yrs, step=0.02945013453871661
step=10000, time=196.52497632980683 yrs, step=6.699937178573698e-11
step=15000, time=196.5249766930108 yrs, step=7.13511577745264e-11
step=20000, time=196.52498488866365 yrs, step=7.762718868876156e-08
step=25000, time=272.17487700592767 yrs, step=1.3297123854634314e-10
step=30000, time=272.1748773997298 yrs, step=7.935965282334024e-11
step=35000, time=272.1748778087133 yrs, step=4.735589336411811e-11
step=40000, time=292.5353440506115 yrs, step=0.025529773554574715
step=45000, time=350.0284817740895 yrs, step=7.585404744348211e-11
step=50000, time=350.0284822570143 yrs, step=1.143552651498551e-10
step=55000, time=350.0284828072335 yrs, step=1.5738959326121706e-09
step=60000, time=428.3603641171298 yrs, step=1.396734966774442e-06
step=65000, time=428.3603895166313 yrs, step=8.38323217562627e-11
step=70000, time=428.36038998662326 yrs, step=6.908460257203191e-11
step=75000, time=432.77635516149826 yrs, step=0.023396389027961796
step=80000, time=506.74075025565014 yrs, step=6.93868099323645e-11
step=85000, time=506.74075072729175 yrs, step=1.3369653621114137e-10
step=90000, time=506.7407511239481 yrs, step=1.6760420204045886e-10
step=95000, time=571.1772883200007 yrs, step=0.03115928106939193
step=100000, time=585.1249321168854 yrs, step=8.195863612220059e-11
step=105000, time=585.1249326058276 yrs, step=7.277153236808961e-11
step=110000, time=585.1651243047899 yrs, step=0.00020757875702647396
step=115000, time=663.509382683838 yrs, step=7.482654241835127e-11
step=120000, time=663.5093831323696 yrs, step=1.1858616819451146e-10
step=125000, time=663.5093835144739 yrs, step=7.228800059155745e-11
step=130000, time=708.7786006395438 yrs, step=0.0306217858381618
step=135000, time=741.8938514583174 yrs, step=9.815695063602784e-11
step=140000, time=741.8938519540883 yrs, step=8.812366627298559e-11
step=145000, time=741.8944130341275 yrs, step=4.4345806513532365e-06
step=150000, time=820.2783209816516 yrs, step=6.962857582063059e-11
step=155000, time=820.2783214059152 yrs, step=1.1133319154652912e-10
step=160000, time=820.2783218379793 yrs, step=4.2550796334829805e-11
step=165000, time=846.4938094052974 yrs, step=0.026173168524190365
step=170000, time=898.6627909507023 yrs, step=7.45847765300852e-11
step=175000, time=898.662791441536 yrs, step=9.126662282044461e-11
step=180000, time=898.6627924229714 yrs, step=6.237439034320691e-09
step=185000, time=977.047260512177 yrs, step=1.2691500304527786e-09
step=190000, time=977.0472609600538 yrs, step=9.042044221151333e-11
step=195000, time=977.0472614254056 yrs, step=6.068323795478569e-11
step=200000, time=984.7989573452244 yrs, step=0.02885660199627129
CPU times: user 1h 28min 3s, sys: 28min 22s, total: 1h 56min 26s
Wall time: 1h 15min 56s
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plotting-the-results">
<h2><span class="section-number">6.7. </span>Plotting the results<a class="headerlink" href="#plotting-the-results" title="Permalink to this headline">¶</a></h2>
<p>Now that we’ve solved for 1000 years of fault slip evolution, let’s plot some of the results. I’ll start with a super simple plot of the maximum log slip rate over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">derivs_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y_history</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t_history</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">max_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">derivs_history</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_history</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">siay</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_vel</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$t ~~ \mathrm{(yrs)}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(V)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/part6_qd_30_0.png" src="../_images/part6_qd_30_0.png" />
</div>
</div>
<p>And next, we’ll make the classic plot showing the spatial distribution of slip over time:</p>
<ul class="simple">
<li><p>the blue lines show interseismic slip evolution and are plotted every fifteen years</p></li>
<li><p>the red lines show evolution during rupture every three seconds.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">last_plt_t</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
<span class="n">last_plt_slip</span> <span class="o">=</span> <span class="n">init_slip_deficit</span>
<span class="n">event_times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_history</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t_history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">slip_deficit</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span> <span class="n">init_slip_deficit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">should_plot</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Plot a red line every three second if the slip rate is over 0.1 mm/s.</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">max_vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0001</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">-</span> <span class="n">last_plt_t</span> <span class="o">&gt;</span> <span class="mi">3</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_times</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">t</span> <span class="o">-</span> <span class="n">event_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">siay</span><span class="p">:</span>
            <span class="n">event_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">should_plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
    
    <span class="c1"># Plot a blue line every fifteen years during the interseismic period</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">last_plt_t</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">siay</span><span class="p">:</span>
        <span class="n">should_plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>

    <span class="k">if</span> <span class="n">should_plot</span><span class="p">:</span>
        <span class="c1"># Convert from slip deficit to slip:</span>
        <span class="n">slip</span> <span class="o">=</span> <span class="o">-</span><span class="n">slip_deficit</span> <span class="o">+</span> <span class="n">Vp</span> <span class="o">*</span> <span class="n">t</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slip</span><span class="p">,</span> <span class="n">fy</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="n">color</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">last_plt_t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">last_plt_slip</span> <span class="o">=</span> <span class="n">slip</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">last_plt_slip</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\textrm{z (km)}$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\textrm{slip (m)}$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;halfspace.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/part6_qd_32_0.png" src="../_images/part6_qd_32_0.png" />
</div>
</div>
<p>And a plot of recurrence interval:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Recurrence interval&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">event_times</span><span class="p">)</span> <span class="o">/</span> <span class="n">siay</span><span class="p">,</span> <span class="s2">&quot;k-*&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Event number&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time between events (yr)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/part6_qd_34_0.png" src="../_images/part6_qd_34_0.png" />
</div>
</div>
</div>
<div class="section" id="comparison-against-scec-seas-results">
<h2><span class="section-number">6.8. </span>Comparison against SCEC SEAS results<a class="headerlink" href="#comparison-against-scec-seas-results" title="Permalink to this headline">¶</a></h2>
<p>Finally, we will compare against the results reported as part of the SEAS project. Here, I’ve grabbed the time series for a point at 7500m depth on the fault from results produced by Junle Jiang.</p>
<p>To compare, I grab the fault history for just the first event and then interpolate the values to a depth of exactly 7500m.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jiang_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;jiang7500.txt&quot;</span><span class="p">)</span>
<span class="n">jiang_slip_rate</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">jiang_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">jiang_stress</span> <span class="o">=</span> <span class="n">jiang_data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_start_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">max_vel</span> <span class="o">&gt;</span> <span class="mf">1e-4</span><span class="p">)</span>
<span class="n">t_end_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">max_vel</span><span class="p">[</span><span class="n">t_start_idx</span><span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">)</span>
<span class="n">n_steps</span> <span class="o">=</span> <span class="n">t_end_idx</span> <span class="o">-</span> <span class="n">t_start_idx</span>
<span class="n">t_chunk</span> <span class="o">=</span> <span class="n">t_history</span><span class="p">[</span><span class="n">t_start_idx</span> <span class="p">:</span> <span class="n">t_end_idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shear_chunk</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">slip_rate_chunk</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
    <span class="n">system_state</span> <span class="o">=</span> <span class="n">SystemState</span><span class="p">()</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="n">t_history</span><span class="p">[</span><span class="n">t_start_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span> <span class="n">y_history</span><span class="p">[</span><span class="n">t_start_idx</span> <span class="o">+</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">slip_deficit</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">tau_qs</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">slip_deficit_rate</span><span class="p">,</span> <span class="n">dstatedt</span> <span class="o">=</span> <span class="n">system_state</span>
    <span class="n">shear_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tau_qs</span> <span class="o">-</span> <span class="n">eta</span> <span class="o">*</span> <span class="n">V</span><span class="p">))</span>
    <span class="n">slip_rate_chunk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">shear_chunk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shear_chunk</span><span class="p">)</span>
<span class="n">slip_rate_chunk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">slip_rate_chunk</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fault_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">((</span><span class="o">-</span><span class="mi">7480</span> <span class="o">&gt;</span> <span class="n">fy</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fy</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">7500</span><span class="p">))</span>
<span class="n">VAvg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">slip_rate_chunk</span><span class="p">[:,</span> <span class="n">fault_idx</span><span class="p">:(</span><span class="n">fault_idx</span><span class="o">+</span><span class="mi">2</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">SAvg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">shear_chunk</span><span class="p">[:,</span> <span class="n">fault_idx</span><span class="p">:(</span><span class="n">fault_idx</span><span class="o">+</span><span class="mi">2</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_align</span> <span class="o">=</span> <span class="n">t_chunk</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">VAvg</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)]</span>
<span class="n">jiang_t_align</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">jiang_slip_rate</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">lims</span> <span class="ow">in</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">)]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_chunk</span> <span class="o">-</span> <span class="n">t_align</span><span class="p">,</span> <span class="n">SAvg</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span> <span class="s2">&quot;k-o&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;here&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">jiang_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">jiang_data</span><span class="p">[</span><span class="n">jiang_t_align</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">jiang_stress</span><span class="p">,</span>
        <span class="s2">&quot;b-*&quot;</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jiang&#39;</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Shear Stress (MPa)&quot;</span><span class="p">)</span>
    <span class="c1"># plt.show()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_chunk</span> <span class="o">-</span> <span class="n">t_align</span><span class="p">,</span> <span class="n">VAvg</span><span class="p">,</span> <span class="s2">&quot;k-o&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;here&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">jiang_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">jiang_data</span><span class="p">[</span><span class="n">jiang_t_align</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">jiang_slip_rate</span><span class="p">[:],</span>
        <span class="s2">&quot;b-*&quot;</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jiang&#39;</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Slip rate (m/s)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/part6_qd_41_0.png" src="../_images/part6_qd_41_0.png" />
<img alt="../_images/part6_qd_41_1.png" src="../_images/part6_qd_41_1.png" />
</div>
</div>
<p>Why don’t the solutions match more precisely? I think the most likely answer is that the Jiang result is using a 3D model that is very long in the <span class="math notranslate nohighlight">\(z\)</span> direction but not truly infinite like the antiplane model here.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./c1qbx"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="part5_viscoelastic.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">5. </span>Viscoelasticity</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="part7_qd_two_faults.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Quasidynamic earthquake cycles on two faults</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By T. Ben Thompson<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>